@model EndUsersPaginatedViewModel
@{
    ViewData["Title"] = "End Users Management";
}

@await Html.PartialAsync("~/Views/Admin/_EndUsersHeader.cshtml", Model)

@await Html.PartialAsync("~/Views/Admin/_EndUsersStatistics.cshtml", Model)

@await Html.PartialAsync("~/Views/Admin/_EndUsersSearchForm.cshtml", Model)

@await Html.PartialAsync("~/Views/Admin/_EndUsersTable.cshtml", Model)

@await Html.PartialAsync("~/Views/Admin/_EndUsersModals.cshtml")

@functions {
    public string GetPageUrl(int page)
    {
        var routeValues = new RouteValueDictionary
        {
            ["page"] = page,
            ["pageSize"] = Model.EndUsers.PageSize
        };

        if (!string.IsNullOrWhiteSpace(Model.SearchPhoneNumber))
            routeValues["searchPhoneNumber"] = Model.SearchPhoneNumber;
            
        if (!string.IsNullOrWhiteSpace(Model.Status))
            routeValues["status"] = Model.Status;

        return Url.Action("EndUsers", "EndUser", routeValues);
    }
}

@section Scripts {
    <script src="~/js/endusers-management.js"></script>
    <script src="~/js/user-modals.js"></script>
    <script src="~/js/playtomic-integration.js"></script>
    
    <script>
        // Configure URLs for the JavaScript files
        const pageSize = @Model.EndUsers.PageSize;
        window.endUsersBaseUrl = '@Url.Action("EndUsers", "EndUser")';
    </script>
}
